<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard de Maturidade em IA</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    <style>
        /* (Estilos mantidos para garantir a visualizaÃ§Ã£o correta) */
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: sans-serif; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); min-height: 100vh; padding: 20px; }
        .container { max-width: 1400px; margin: 0 auto; background: white; border-radius: 16px; overflow: hidden; box-shadow: 0 20px 60px rgba(0,0,0,0.3); }
        .header { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 30px; text-align: center; }
        .loading { text-align: center; padding: 60px; color: #667eea; }
        .error-msg { background: #fee; color: #c33; padding: 20px; margin: 20px; border-radius: 8px; border-left: 4px solid #c33; }
        .tabs { display: flex; background: #f8f9fa; border-bottom: 2px solid #e9ecef; }
        .tab { flex: 1; padding: 20px; cursor: pointer; border: none; background: transparent; font-weight: bold; }
        .tab.active { background: white; color: #667eea; border-bottom: 3px solid #667eea; }
        .tab-content { display: none; padding: 30px; }
        .tab-content.active { display: block; }
        .kpis { display: grid; grid-template-columns: repeat(auto-fit, minmax(240px, 1fr)); gap: 20px; margin-bottom: 30px; }
        .kpi-card { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 25px; border-radius: 12px; }
        .charts { display: grid; grid-template-columns: repeat(auto-fit, minmax(400px, 1fr)); gap: 25px; }
        .chart-card { background: white; border: 1px solid #e9ecef; border-radius: 12px; padding: 25px; }
        .chart-container { height: 300px; position: relative; }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ðŸ“Š Dashboard de Maturidade em IA</h1>
            <p>AnÃ¡lise de AdoÃ§Ã£o e Uso de InteligÃªncia Artificial</p>
        </div>

        <div id="loading" class="loading">
            Carregando dados da planilha...<br>
            <small>Aguarde enquanto processamos as informaÃ§Ãµes</small>
        </div>

        <div id="error-container" style="display: none;"></div>

        <div id="dashboard" style="display: none;">
            <div class="tabs">
                <button class="tab active" onclick="switchTab(0)">ðŸ“‹ Respostas</button>
                <button class="tab" onclick="switchTab(1)">ðŸ“ˆ GrÃ¡ficos de Perfil</button>
            </div>

            <div class="tab-content active" id="tab-0">
                <div class="kpis" id="kpis"></div>
                <div class="charts">
                    <div class="chart-card">
                        <h3>FrequÃªncia de Uso</h3>
                        <div class="chart-container"><canvas id="chartFrequencia"></canvas></div>
                    </div>
                    <div class="chart-card">
                        <h3>VÃ­nculo Institucional</h3>
                        <div class="chart-container"><canvas id="chartVinculo"></canvas></div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // CONFIGURAÃ‡ÃƒO ATUALIZADA
        const SPREADSHEET_ID = "19NMA5UhmjIEGOvPuSOe2wZCII7q1nP7g8RcThDEhUXg";
        const SHEET_RESP = "Respostas ao formulÃ¡rio 1"; // CORRIGIDO PARA "AO"

        async function loadData() {
            const url = `https://docs.google.com/spreadsheets/d/${SPREADSHEET_ID}/gviz/tq?tqx=out:json&sheet=${encodeURIComponent(SHEET_RESP)}`;
            
            try {
                const response = await fetch(url);
                const text = await response.text();
                const json = JSON.parse(text.substring(47).slice(0, -2));
                
                const data = json.table.rows.map(row => ({
                    vinculo: row.c[2] ? row.c[2].v : '',
                    freq: row.c[6] ? row.c[6].v : ''
                }));

                renderDashboard(data);
            } catch (e) {
                document.getElementById('loading').style.display = 'none';
                const errDiv = document.getElementById('error-container');
                errDiv.style.display = 'block';
                errDiv.innerHTML = `<div class="error-msg">
                    <strong>Erro de ConexÃ£o:</strong> NÃ£o foi possÃ­vel acessar a planilha.<br>
                    Certifique-se de que a planilha estÃ¡ <b>Publicada na Web</b> e que vocÃª estÃ¡ abrindo este arquivo HTML diretamente no seu navegador, e nÃ£o dentro de um chat.
                </div>`;
            }
        }

        function renderDashboard(data) {
            document.getElementById('loading').style.display = 'none';
            document.getElementById('dashboard').style.display = 'block';
            
            // KPI Simples
            document.getElementById('kpis').innerHTML = `
                <div class="kpi-card"><h3>Total de Respostas</h3><div style="font-size:2rem">${data.length}</div></div>
            `;

            // GrÃ¡fico de FrequÃªncia
            const freqCounts = data.reduce((acc, r) => { acc[r.freq] = (acc[r.freq] || 0) + 1; return acc; }, {});
            new Chart(document.getElementById('chartFrequencia'), {
                type: 'bar',
                data: {
                    labels: Object.keys(freqCounts),
                    datasets: [{ label: 'Qtd', data: Object.values(freqCounts), backgroundColor: '#667eea' }]
                },
                options: { responsive: true, maintainAspectRatio: false }
            });

            // GrÃ¡fico de VÃ­nculo
            const vincCounts = data.reduce((acc, r) => { acc[r.vinculo] = (acc[r.vinculo] || 0) + 1; return acc; }, {});
            new Chart(document.getElementById('chartVinculo'), {
                type: 'pie',
                data: {
                    labels: Object.keys(vincCounts),
                    datasets: [{ data: Object.values(vincCounts), backgroundColor: ['#764ba2', '#f093fb', '#4facfe'] }]
                },
                options: { responsive: true, maintainAspectRatio: false }
            });
        }

        function switchTab(idx) {
            document.querySelectorAll('.tab').forEach((t, i) => t.classList.toggle('active', i === idx));
            document.querySelectorAll('.tab-content').forEach((c, i) => c.classList.toggle('active', i === idx));
        }

        loadData();
    </script>
</body>
</html>