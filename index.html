<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Dashboard de Maturidade em IA</title>
  
  <!-- CDN Libraries -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&family=Roboto+Mono&display=swap" rel="stylesheet">
  
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
  
  <style>
    :root {
      --color-advanced: #4CAF50;
      --color-intermediate: #FF9800;
      --color-beginner: #F44336;
      --color-accent: #2196F3;
      --color-text: #333;
      --color-bg: #f5f5f5;
      --color-card-bg: #ffffff;
      --color-border: #e0e0e0;
      --color-text-secondary: #757575;
    }
    
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    
    body {
      font-family: 'Roboto', sans-serif;
      background-color: var(--color-bg);
      color: var(--color-text);
      line-height: 1.6;
    }
    
    /* Header */
    #dashboard-header {
      background: linear-gradient(135deg, var(--color-accent) 0%, #1976D2 100%);
      color: white;
      padding: 20px;
      position: sticky;
      top: 0;
      z-index: 1000;
      box-shadow: 0 2px 8px rgba(0,0,0,0.15);
    }
    
    .header-top {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
      flex-wrap: wrap;
      gap: 10px;
    }
    
    .header-title {
      display: flex;
      align-items: center;
      gap: 10px;
    }
    
    .header-title h1 {
      font-size: clamp(1.2rem, 3vw, 1.8rem);
      font-weight: 700;
      margin: 0;
    }
    
    .last-update {
      font-size: 0.9rem;
      opacity: 0.9;
    }
    
    .btn-refresh {
      background: rgba(255,255,255,0.2);
      border: 2px solid white;
      color: white;
      padding: 10px 20px;
      border-radius: 25px;
      cursor: pointer;
      transition: all 0.3s;
      font-weight: 500;
    }
    
    .btn-refresh:hover {
      background: white;
      color: var(--color-accent);
    }
    
    .btn-refresh.loading {
      pointer-events: none;
      opacity: 0.7;
    }
    
    /* Filters */
    .filters-section {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
      gap: 15px;
      margin-top: 15px;
    }
    
    .filter-group {
      display: flex;
      flex-direction: column;
    }
    
    .filter-group label {
      font-size: 0.85rem;
      margin-bottom: 5px;
      opacity: 0.9;
    }
    
    .filter-group select,
    .filter-group input {
      padding: 8px 12px;
      border: none;
      border-radius: 8px;
      background: rgba(255,255,255,0.95);
      color: var(--color-text);
      font-size: 0.9rem;
    }
    
    .filter-actions {
      display: flex;
      gap: 10px;
      align-items: flex-end;
      margin-top: 10px;
    }
    
    .btn-clear-filters {
      background: rgba(244, 67, 54, 0.9);
      color: white;
      border: none;
      padding: 8px 16px;
      border-radius: 8px;
      cursor: pointer;
      font-size: 0.85rem;
      transition: all 0.3s;
    }
    
    .btn-clear-filters:hover {
      background: #D32F2F;
    }
    
    .filter-count {
      color: white;
      font-size: 0.9rem;
      padding: 8px 0;
    }
    
    /* Container */
    .dashboard-container {
      max-width: 1800px;
      margin: 0 auto;
      padding: 20px;
    }
    
    /* Section */
    .dashboard-section {
      margin-bottom: 30px;
    }
    
    .section-title {
      font-size: 1.4rem;
      font-weight: 700;
      margin-bottom: 20px;
      color: var(--color-text);
      border-left: 4px solid var(--color-accent);
      padding-left: 15px;
    }
    
    /* KPI Cards */
    .kpi-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
      gap: 20px;
      margin-bottom: 30px;
    }
    
    .kpi-card {
      background: var(--color-card-bg);
      border-radius: 12px;
      padding: 20px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
      transition: transform 0.3s, box-shadow 0.3s;
      cursor: pointer;
    }
    
    .kpi-card:hover {
      transform: translateY(-5px);
      box-shadow: 0 4px 16px rgba(0,0,0,0.15);
    }
    
    .kpi-header {
      display: flex;
      align-items: center;
      gap: 10px;
      margin-bottom: 15px;
    }
    
    .kpi-icon {
      font-size: 1.8rem;
    }
    
    .kpi-title {
      font-size: 0.85rem;
      color: var(--color-text-secondary);
      text-transform: uppercase;
      font-weight: 500;
    }
    
    .kpi-value {
      font-size: 2.5rem;
      font-weight: 700;
      font-family: 'Roboto Mono', monospace;
      margin-bottom: 5px;
    }
    
    .kpi-subtitle {
      font-size: 0.9rem;
      color: var(--color-text-secondary);
    }
    
    .kpi-trend {
      display: flex;
      align-items: center;
      gap: 5px;
      font-size: 0.85rem;
      margin-top: 10px;
    }
    
    .trend-up {
      color: var(--color-advanced);
    }
    
    .trend-down {
      color: var(--color-beginner);
    }
    
    .progress-bar-container {
      width: 100%;
      height: 8px;
      background: #e0e0e0;
      border-radius: 4px;
      overflow: hidden;
      margin-top: 10px;
    }
    
    .progress-bar {
      height: 100%;
      transition: width 0.5s ease;
    }
    
    /* Charts Grid */
    .charts-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(450px, 1fr));
      gap: 20px;
      margin-bottom: 30px;
    }
    
    .chart-card {
      background: var(--color-card-bg);
      border-radius: 12px;
      padding: 20px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    }
    
    .chart-header {
      margin-bottom: 15px;
    }
    
    .chart-title {
      font-size: 1.1rem;
      font-weight: 600;
      color: var(--color-text);
    }
    
    .chart-container {
      position: relative;
      height: 350px;
    }
    
    canvas {
      max-height: 100%;
    }
    
    /* Table */
    .priority-table {
      width: 100%;
      background: var(--color-card-bg);
      border-radius: 12px;
      overflow: hidden;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    }
    
    .priority-table table {
      width: 100%;
      border-collapse: collapse;
    }
    
    .priority-table th {
      background: var(--color-accent);
      color: white;
      padding: 15px;
      text-align: left;
      font-weight: 600;
    }
    
    .priority-table td {
      padding: 12px 15px;
      border-bottom: 1px solid var(--color-border);
    }
    
    .priority-table tr:hover {
      background: #f8f8f8;
    }
    
    .action-badge {
      padding: 5px 12px;
      border-radius: 20px;
      font-size: 0.85rem;
      font-weight: 500;
      display: inline-block;
    }
    
    .action-critical {
      background: #ffebee;
      color: #c62828;
    }
    
    .action-warning {
      background: #fff3e0;
      color: #e65100;
    }
    
    .action-success {
      background: #e8f5e9;
      color: #2e7d32;
    }
    
    /* Recommendations */
    .recommendations-container {
      display: grid;
      gap: 15px;
      margin-top: 20px;
    }
    
    .recommendation-card {
      background: var(--color-card-bg);
      border-left: 4px solid;
      border-radius: 8px;
      padding: 20px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    }
    
    .recommendation-card.critical {
      border-color: var(--color-beginner);
      background: #ffebee;
    }
    
    .recommendation-card.opportunity {
      border-color: var(--color-advanced);
      background: #e8f5e9;
    }
    
    .recommendation-card.priority {
      border-color: var(--color-intermediate);
      background: #fff3e0;
    }
    
    .recommendation-header {
      display: flex;
      align-items: center;
      gap: 10px;
      margin-bottom: 10px;
    }
    
    .recommendation-icon {
      font-size: 1.5rem;
    }
    
    .recommendation-title {
      font-size: 1.1rem;
      font-weight: 600;
    }
    
    .recommendation-action {
      margin-top: 10px;
      padding: 10px;
      background: rgba(255,255,255,0.7);
      border-radius: 6px;
      font-weight: 500;
    }
    
    /* Footer */
    footer {
      background: var(--color-card-bg);
      padding: 30px 20px;
      margin-top: 40px;
      box-shadow: 0 -2px 8px rgba(0,0,0,0.1);
    }
    
    .footer-actions {
      display: flex;
      gap: 15px;
      justify-content: center;
      flex-wrap: wrap;
    }
    
    .btn-export {
      background: var(--color-accent);
      color: white;
      border: none;
      padding: 12px 24px;
      border-radius: 8px;
      cursor: pointer;
      font-weight: 500;
      transition: all 0.3s;
      display: flex;
      align-items: center;
      gap: 8px;
    }
    
    .btn-export:hover {
      background: #1976D2;
      transform: translateY(-2px);
    }
    
    /* Loading */
    .loading-spinner {
      display: none;
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      z-index: 9999;
      background: rgba(255,255,255,0.95);
      padding: 30px;
      border-radius: 12px;
      box-shadow: 0 4px 20px rgba(0,0,0,0.2);
    }
    
    .loading-spinner.active {
      display: block;
    }
    
    .spinner {
      border: 4px solid #f3f3f3;
      border-top: 4px solid var(--color-accent);
      border-radius: 50%;
      width: 60px;
      height: 60px;
      animation: spin 1s linear infinite;
      margin: 0 auto;
    }
    
    .loading-text {
      margin-top: 15px;
      text-align: center;
      color: var(--color-text);
      font-weight: 500;
    }
    
    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
    
    /* Toast */
    .toast-container {
      position: fixed;
      top: 80px;
      right: 20px;
      z-index: 9998;
    }
    
    .toast {
      background: var(--color-card-bg);
      padding: 15px 20px;
      border-radius: 8px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.2);
      margin-bottom: 10px;
      animation: slideIn 0.3s ease;
      display: flex;
      align-items: center;
      gap: 10px;
      min-width: 300px;
    }
    
    @keyframes slideIn {
      from {
        transform: translateX(400px);
        opacity: 0;
      }
      to {
        transform: translateX(0);
        opacity: 1;
      }
    }
    
    .toast.success {
      border-left: 4px solid var(--color-advanced);
    }
    
    .toast.error {
      border-left: 4px solid var(--color-beginner);
    }
    
    /* Validation Banner */
    .validation-banner {
      background: #fff3e0;
      border-left: 4px solid var(--color-intermediate);
      padding: 15px 20px;
      margin: 20px;
      border-radius: 8px;
      display: none;
    }
    
    .validation-banner.active {
      display: block;
    }
    
    /* Help Section */
    .help-section {
      background: var(--color-card-bg);
      border-radius: 12px;
      padding: 20px;
      margin: 20px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    }
    
    .help-toggle {
      cursor: pointer;
      display: flex;
      align-items: center;
      gap: 10px;
      font-weight: 600;
      color: var(--color-accent);
    }
    
    .help-content {
      display: none;
      margin-top: 15px;
      padding-top: 15px;
      border-top: 1px solid var(--color-border);
    }
    
    .help-content.active {
      display: block;
    }
    
    .help-content h4 {
      margin-top: 15px;
      margin-bottom: 10px;
      color: var(--color-accent);
    }
    
    .help-content ul {
      margin-left: 20px;
    }
    
    .help-content li {
      margin-bottom: 8px;
    }
    
    /* Responsive */
    @media (max-width: 768px) {
      .charts-grid {
        grid-template-columns: 1fr;
      }
      
      .kpi-grid {
        grid-template-columns: 1fr;
      }
      
      .chart-container {
        height: 300px;
      }
      
      .filters-section {
        grid-template-columns: 1fr;
      }
      
      .header-top {
        flex-direction: column;
        align-items: flex-start;
      }
      
      .footer-actions {
        flex-direction: column;
      }
      
      .btn-export {
        width: 100%;
        justify-content: center;
      }
    }
    
    @media (min-width: 768px) and (max-width: 1199px) {
      .kpi-grid {
        grid-template-columns: repeat(2, 1fr);
      }
      
      .charts-grid {
        grid-template-columns: repeat(2, 1fr);
      }
    }
    
    @media (min-width: 1200px) {
      .kpi-grid {
        grid-template-columns: repeat(3, 1fr);
      }
    }
  </style>
</head>

<body>
  <!-- Loading Spinner -->
  <div class="loading-spinner" id="loadingSpinner">
    <div class="spinner"></div>
    <div class="loading-text">Carregando dados...</div>
  </div>
  
  <!-- Toast Container -->
  <div class="toast-container" id="toastContainer"></div>
  
  <!-- Validation Banner -->
  <div class="validation-banner" id="validationBanner">
    <strong>‚ö†Ô∏è Avisos de qualidade de dados detectados</strong>
    <div id="validationDetails"></div>
  </div>
  
  <!-- Header -->
  <header id="dashboard-header">
    <div class="header-top">
      <div class="header-title">
        <i class="fas fa-brain"></i>
        <div>
          <h1>Dashboard de Maturidade em IA</h1>
          <div class="last-update" id="lastUpdate">√öltima atualiza√ß√£o: Carregando...</div>
        </div>
      </div>
      <button class="btn-refresh" id="btnRefresh">
        <i class="fas fa-sync-alt"></i> Atualizar Dados
      </button>
    </div>
    
    <div class="filters-section">
      <div class="filter-group">
        <label>E-mail</label>
        <input type="text" id="filterEmail" placeholder="Buscar por e-mail...">
      </div>
      <div class="filter-group">
        <label>V√≠nculo</label>
        <select id="filterVinculo">
          <option value="">Todos</option>
        </select>
      </div>
      <div class="filter-group">
        <label>√Årea de Atua√ß√£o</label>
        <select id="filterArea">
          <option value="">Todos</option>
        </select>
      </div>
      <div class="filter-group">
        <label>Faixa Et√°ria</label>
        <select id="filterFaixaEtaria">
          <option value="">Todos</option>
        </select>
      </div>
      <div class="filter-group">
        <label>Vincula√ß√£o</label>
        <select id="filterVinculacao">
          <option value="">Todos</option>
        </select>
      </div>
    </div>
    
    <div class="filter-actions">
      <button class="btn-clear-filters" id="btnClearFilters">
        <i class="fas fa-times"></i> Limpar Filtros
      </button>
      <div class="filter-count" id="filterCount">Exibindo 0 de 0 respondentes</div>
    </div>
  </header>
  
  <!-- Dashboard Container -->
  <div class="dashboard-container">
    
    <!-- KPI Section -->
    <section id="kpi-section" class="dashboard-section">
      <div class="kpi-grid">
        <!-- KPI 1: Total Respondentes -->
        <div class="kpi-card" data-kpi="total">
          <div class="kpi-header">
            <div class="kpi-icon">üë•</div>
            <div class="kpi-title">Total Respondentes</div>
          </div>
          <div class="kpi-value" id="kpiTotal">0</div>
          <div class="kpi-subtitle">Participantes do diagn√≥stico</div>
        </div>
        
        <!-- KPI 2: Maturidade Global -->
        <div class="kpi-card" data-kpi="maturidade">
          <div class="kpi-header">
            <div class="kpi-icon">üìä</div>
            <div class="kpi-title">Maturidade Global</div>
          </div>
          <div class="kpi-value" id="kpiMaturidade">0.0</div>
          <div class="kpi-subtitle">/100 pontos</div>
          <div class="progress-bar-container">
            <div class="progress-bar" id="progressMaturidade" style="width: 0%; background: #4CAF50;"></div>
          </div>
        </div>
        
        <!-- KPI 3: Taxa de Ado√ß√£o -->
        <div class="kpi-card" data-kpi="adocao">
          <div class="kpi-header">
            <div class="kpi-icon">‚úÖ</div>
            <div class="kpi-title">Taxa de Ado√ß√£o de IA</div>
          </div>
          <div class="kpi-value" id="kpiAdocao">0%</div>
          <div class="kpi-subtitle">Respondentes com experi√™ncia em IA</div>
        </div>
        
        <!-- KPI 4: Conformidade LGPD -->
        <div class="kpi-card" data-kpi="conformidade">
          <div class="kpi-header">
            <div class="kpi-icon">üîí</div>
            <div class="kpi-title">Conformidade LGPD</div>
          </div>
          <div class="kpi-value" id="kpiConformidade">0%</div>
          <div class="kpi-subtitle">Com cuidados adequados com dados</div>
        </div>
        
        <!-- KPI 5: IPO -->
        <div class="kpi-card" data-kpi="ipo">
          <div class="kpi-header">
            <div class="kpi-icon">‚ö†Ô∏è</div>
            <div class="kpi-title">√çndice de Prontid√£o Org (IPO)</div>
          </div>
          <div class="kpi-value" id="kpiIPO">0.0</div>
          <div class="kpi-subtitle" id="kpiIPOStatus">/100 - Status: AGUARDANDO</div>
        </div>
        
        <!-- KPI 6: Risco Cr√≠tico -->
        <div class="kpi-card" data-kpi="risco">
          <div class="kpi-header">
            <div class="kpi-icon">üéØ</div>
            <div class="kpi-title">Taxa de Risco Cr√≠tico</div>
          </div>
          <div class="kpi-value" id="kpiRisco">0%</div>
          <div class="kpi-subtitle" id="kpiRiscoCount">0 colaboradores</div>
        </div>
      </div>
    </section>
    
    <!-- Behavioral Analysis Section -->
    <section id="behavior-section" class="dashboard-section">
      <h2 class="section-title">An√°lise Comportamental</h2>
      <div class="charts-grid">
        <div class="chart-card">
          <div class="chart-header">
            <h3 class="chart-title">Distribui√ß√£o de Maturidade</h3>
          </div>
          <div class="chart-container">
            <canvas id="chartMaturity"></canvas>
          </div>
        </div>
        
        <div class="chart-card">
          <div class="chart-header">
            <h3 class="chart-title">Ferramentas Mais Utilizadas</h3>
          </div>
          <div class="chart-container">
            <canvas id="chartTools"></canvas>
          </div>
        </div>
        
        <div class="chart-card">
          <div class="chart-header">
            <h3 class="chart-title">Frequ√™ncia de Uso no Trabalho</h3>
          </div>
          <div class="chart-container">
            <canvas id="chartFrequency"></canvas>
          </div>
        </div>
        
        <div class="chart-card">
          <div class="chart-header">
            <h3 class="chart-title">√Åreas √ó N√≠vel de Conhecimento</h3>
          </div>
          <div class="chart-container">
            <canvas id="chartAreasKnowledge"></canvas>
          </div>
        </div>
      </div>
    </section>
    
    <!-- Competency Analysis Section -->
    <section id="competency-section" class="dashboard-section">
      <h2 class="section-title">Diagn√≥stico de Compet√™ncias</h2>
      <div class="charts-grid">
        <div class="chart-card">
          <div class="chart-header">
            <h3 class="chart-title">Radar de Compet√™ncias (12 Dimens√µes)</h3>
          </div>
          <div class="chart-container">
            <canvas id="chartRadar"></canvas>
          </div>
        </div>
        
        <div class="chart-card">
          <div class="chart-header">
            <h3 class="chart-title">Distribui√ß√£o de Pontua√ß√£o Total</h3>
          </div>
          <div class="chart-container">
            <canvas id="chartHistogram"></canvas>
          </div>
        </div>
      </div>
    </section>
    
    <!-- Development Strategy Section -->
    <section id="development-section" class="dashboard-section">
      <h2 class="section-title">Estrat√©gia de Desenvolvimento</h2>
      <div class="charts-grid">
        <div class="chart-card">
          <div class="chart-header">
            <h3 class="chart-title">Maturidade por V√≠nculo Institucional</h3>
          </div>
          <div class="chart-container">
            <canvas id="chartMaturityByVinculo"></canvas>
          </div>
        </div>
        
        <div class="chart-card">
          <div class="chart-header">
            <h3 class="chart-title">Trilhas de Aprendizado Sugeridas</h3>
          </div>
          <div class="chart-container">
            <canvas id="chartTrilhas"></canvas>
          </div>
        </div>
      </div>
      
      <!-- Priority Table -->
      <div class="priority-table" style="margin-top: 20px;">
        <table>
          <thead>
            <tr>
              <th>V√≠nculo/√Årea</th>
              <th>Respondentes</th>
              <th>% Iniciante</th>
              <th>A√ß√£o Recomendada</th>
            </tr>
          </thead>
          <tbody id="priorityTableBody">
            <tr>
              <td colspan="4" style="text-align: center; padding: 20px;">Carregando dados...</td>
            </tr>
          </tbody>
        </table>
      </div>
    </section>
    
    <!-- Insights Section -->
    <section id="insights-section" class="dashboard-section">
      <h2 class="section-title">Insights Preditivos e Diagn√≥sticos</h2>
      <div class="charts-grid">
        <div class="chart-card">
          <div class="chart-header">
            <h3 class="chart-title">Matriz de Autoconhecimento</h3>
          </div>
          <div class="chart-container">
            <canvas id="chartScatter"></canvas>
          </div>
        </div>
        
        <div class="chart-card">
          <div class="chart-header">
            <h3 class="chart-title">Mapa de Calor de Correla√ß√£o (P1-P12)</h3>
          </div>
          <div class="chart-container">
            <canvas id="chartHeatmap"></canvas>
          </div>
        </div>
      </div>
      
      <!-- Recommendations -->
      <div style="margin-top: 30px;">
        <h3 class="section-title">ü§ñ Recomenda√ß√µes Automatizadas</h3>
        <div class="recommendations-container" id="recommendationsContainer">
          <p style="text-align: center; color: var(--color-text-secondary);">Carregando recomenda√ß√µes...</p>
        </div>
      </div>
    </section>
    
    <!-- Help Section -->
    <div class="help-section">
      <div class="help-toggle" onclick="toggleHelp()">
        <i class="fas fa-question-circle"></i>
        <span>üìñ Como Configurar a Planilha</span>
        <i class="fas fa-chevron-down" id="helpChevron"></i>
      </div>
      <div class="help-content" id="helpContent">
        <h4>1. Publicar a planilha como p√°gina web:</h4>
        <ul>
          <li>Abra a planilha no Google Sheets</li>
          <li>V√° em <strong>Arquivo ‚Üí Compartilhar ‚Üí Publicar na Web</strong></li>
          <li>Na primeira aba, selecione a aba "Respostas ao formul√°rio 1"</li>
          <li>Formato: <strong>P√°gina da Web</strong></li>
          <li>Clique em <strong>Publicar</strong></li>
          <li>Repita o processo para as abas "Pontua√ß√£o" e "Classifica√ß√£o"</li>
        </ul>
        
        <h4>2. Alternativa: Usar CSV publicado</h4>
        <ul>
          <li>V√° em <strong>Arquivo ‚Üí Compartilhar ‚Üí Publicar na Web</strong></li>
          <li>Selecione cada aba e escolha formato <strong>CSV</strong></li>
          <li>Copie os links gerados</li>
          <li>Cole os links no c√≥digo JavaScript (veja instru√ß√µes abaixo)</li>
        </ul>
        
        <h4>3. Permiss√µes de compartilhamento:</h4>
        <ul>
          <li>Clique em <strong>"Compartilhar"</strong> (canto superior direito)</li>
          <li>Altere para <strong>"Qualquer pessoa com o link"</strong></li>
          <li>Permiss√£o: <strong>"Visualizador"</strong></li>
        </ul>
        
        <h4>4. Troubleshooting:</h4>
        <ul>
          <li><strong>Erro CORS:</strong> Certifique-se de que publicou como CSV ou p√°gina web</li>
          <li><strong>Dados n√£o carregam:</strong> Verifique se a planilha est√° p√∫blica</li>
          <li><strong>Formato incorreto:</strong> Mantenha os nomes das abas exatos</li>
        </ul>
      </div>
    </div>
  </div>
  
  <!-- Footer -->
  <footer>
    <div class="footer-actions">
      <button class="btn-export" onclick="exportCSV()">
        <i class="fas fa-file-csv"></i> Exportar Dados (CSV)
      </button>
    </div>
    <div style="text-align: center; margin-top: 20px; color: var(--color-text-secondary); font-size: 0.85rem;">
      Dashboard de Maturidade em IA v2.0 | Desenvolvido com Chart.js e Google Sheets
    </div>
  </footer>

  <script>
    // ============================================================
    // CONFIGURA√á√ÉO - ALTERE ESTAS URLs
    // ============================================================
    // INSTRU√á√ïES PARA OBTER AS URLs CORRETAS:
    // 1. Abra sua planilha no Google Sheets
    // 2. V√° em Arquivo ‚Üí Compartilhar ‚Üí Publicar na Web
    // 3. Selecione cada aba individualmente
    // 4. Escolha formato "Valores separados por v√≠rgula (.csv)"
    // 5. Clique em "Publicar"
    // 6. Copie a URL gerada e cole abaixo
    // ============================================================
    
    const SHEET_CONFIG = {
      // Cole aqui a URL CSV da aba "Respostas ao formul√°rio 1"
      aba1: 'https://docs.google.com/spreadsheets/d/e/2PACX-1vRUhCQ33P_AcMz7ZjOjWEXwyRJ7faDFAghTYI5j5tMjhrI8BvYtW8ERr2u2KqdRdvG1ZsN-3N8LuNGy/pub?output=csv',
      
      // Cole aqui a URL CSV da aba "Pontua√ß√£o"
      aba2: 'https://docs.google.com/spreadsheets/d/e/2PACX-1vRUhCQ33P_AcMz7ZjOjWEXwyRJ7faDFAghTYI5j5tMjhrI8BvYtW8ERr2u2KqdRdvG1ZsN-3N8LuNGy/pub?output=csv',
      
      // Cole aqui a URL CSV da aba "Classifica√ß√£o"
      aba3: 'https://docs.google.com/spreadsheets/d/e/2PACX-1vRUhCQ33P_AcMz7ZjOjWEXwyRJ7faDFAghTYI5j5tMjhrI8BvYtW8ERr2u2KqdRdvG1ZsN-3N8LuNGy/pub?output=csv'
    };
    
    // IMPORTANTE: Se voc√™ n√£o tiver as URLs acima, use este m√©todo alternativo:
    // Substitua SHEET_ID pelo ID da sua planilha e ajuste os gid conforme necess√°rio
    const SHEET_ID = '19NMA5UhmjIEGOvPuSOe2wZCII7q1nP7g8RcThDEhUXg';
    
    // Fun√ß√£o para construir URL de forma alternativa (caso as URLs acima n√£o funcionem)
    function buildSheetURL(gid) {
      return `https://docs.google.com/spreadsheets/d/${SHEET_ID}/export?format=csv&gid=${gid}`;
    }
    
    // ============================================================
    // GLOBAL DATA STORAGE
    // ============================================================
    
    let dashboardData = {
      respondents: [],
      metadata: {
        lastUpdate: null,
        totalRespondents: 0
      }
    };
    
    let filteredData = [];
    let charts = {};
    
    // ============================================================
    // UTILITY FUNCTIONS
    // ============================================================
    
    function showLoadingSpinner() {
      document.getElementById('loadingSpinner').classList.add('active');
    }
    
    function hideLoadingSpinner() {
      document.getElementById('loadingSpinner').classList.remove('active');
    }
    
    function showToast(message, type = 'success') {
      const container = document.getElementById('toastContainer');
      const toast = document.createElement('div');
      toast.className = `toast ${type}`;
      toast.innerHTML = `
        <i class="fas fa-${type === 'success' ? 'check-circle' : 'exclamation-circle'}"></i>
        <span>${message}</span>
      `;
      container.appendChild(toast);
      
      setTimeout(() => {
        toast.remove();
      }, 4000);
    }
    
    function toggleHelp() {
      const content = document.getElementById('helpContent');
      const chevron = document.getElementById('helpChevron');
      content.classList.toggle('active');
      chevron.style.transform = content.classList.contains('active') ? 'rotate(180deg)' : 'rotate(0deg)';
      chevron.style.transition = 'transform 0.3s';
    }
    
    // ============================================================
    // CSV PARSING FUNCTION
    // ============================================================
    
    function parseCSV(csvText) {
      const lines = csvText.split('\n');
      const headers = lines[0].split(',').map(h => h.trim().replace(/"/g, ''));
      const data = [];
      
      for (let i = 1; i < lines.length; i++) {
        if (!lines[i].trim()) continue;
        
        const values = [];
        let currentValue = '';
        let insideQuotes = false;
        
        for (let j = 0; j < lines[i].length; j++) {
          const char = lines[i][j];
          
          if (char === '"') {
            insideQuotes = !insideQuotes;
          } else if (char === ',' && !insideQuotes) {
            values.push(currentValue.trim().replace(/"/g, ''));
            currentValue = '';
          } else {
            currentValue += char;
          }
        }
        values.push(currentValue.trim().replace(/"/g, ''));
        
        const row = {};
        headers.forEach((header, index) => {
          row[header] = values[index] || '';
        });
        
        data.push(row);
      }
      
      return data;
    }
    
    // ============================================================
    // DATA PROCESSING FUNCTIONS
    // ============================================================
    
    function splitMultipleChoice(value) {
      if (!value) return [];
      return value.split(/[,;]/)
                  .map(item => item.trim())
                  .filter(item => item.length > 0);
    }
    
    function mapContatoIA(value) {
      if (!value) return "N√£o";
      
      const valueLower = value.toLowerCase().trim();
      
      const contatoPositivo = [
        "j√° usei",
        "uso com certa",
        "uso frequentemente"
      ];
      
      const contatoNegativo = [
        "nunca"
      ];
      
      if (contatoPositivo.some(phrase => valueLower.includes(phrase))) {
        return "Sim";
      }
      
      if (contatoNegativo.some(phrase => valueLower.includes(phrase))) {
        return "N√£o";
      }
      
      console.warn(`‚ö†Ô∏è Valor inesperado na Coluna J (Contato IA): "${value}"`);
      return "N√£o";
    }
    
    function mapCuidadosDados(value) {
      if (!value) return "N√£o";
      
      const valueLower = value.toLowerCase().trim();
      
      const cuidadoPositivo = [
        "sim",
        "evito sempre",
        "tenho cuidado",
        "sempre"
      ];
      
      const cuidadoNegativo = [
        "n√£o",
        "n√£o sabia",
        "√†s vezes",
        "raramente"
      ];
      
      if (cuidadoPositivo.some(phrase => valueLower.includes(phrase))) {
        return "Sim";
      }
      
      if (cuidadoNegativo.some(phrase => valueLower.includes(phrase))) {
        return "N√£o";
      }
      
      console.warn(`‚ö†Ô∏è Valor inesperado na Coluna X (Cuidados Dados): "${value}"`);
      return "N√£o";
    }
    
    function classifyMaturity(score) {
      if (score <= 40) return "Iniciante";
      if (score <= 70) return "Intermedi√°rio";
      return "Avan√ßado";
    }
    
    function convertKnowledgeLevel(value) {
      if (!value) return 1;
      const valueLower = value.toLowerCase();
      
      if (valueLower.includes('nenhum')) return 1;
      if (valueLower.includes('b√°sico')) return 2;
      if (valueLower.includes('intermedi√°rio')) return 3;
      if (valueLower.includes('avan√ßado')) return 4;
      if (valueLower.includes('especializado')) return 5;
      
      return 2;
    }
    
    // ============================================================
    // FETCH DATA FROM GOOGLE SHEETS
    // ============================================================
    
    async function fetchSheetData(url, sheetName) {
      try {
        const response = await fetch(url);
        
        if (!response.ok) {
          throw new Error(`HTTP error! status: ${response.status}`);
        }
        
        const csvText = await response.text();
        console.log(`‚úì Aba "${sheetName}" carregada com sucesso`);
        return parseCSV(csvText);
      } catch (error) {
        console.error(`‚úó Erro ao carregar aba "${sheetName}":`, error);
        throw error;
      }
    }
    
    async function loadAllData() {
      try {
        showLoadingSpinner();
        
        // Tente primeiro com as URLs configuradas
        let aba1Data, aba2Data, aba3Data;
        
        try {
          // M√©todo 1: URLs diretas das abas publicadas
          if (SHEET_CONFIG.aba1 && !SHEET_CONFIG.aba1.includes('PACX-1vTxyz')) {
            [aba1Data, aba2Data, aba3Data] = await Promise.all([
              fetchSheetData(SHEET_CONFIG.aba1, 'Respostas ao formul√°rio 1'),
              fetchSheetData(SHEET_CONFIG.aba2, 'Pontua√ß√£o'),
              fetchSheetData(SHEET_CONFIG.aba3, 'Classifica√ß√£o')
            ]);
          } else {
            throw new Error('URLs n√£o configuradas, usando m√©todo alternativo');
          }
        } catch (error) {
          console.warn('M√©todo 1 falhou, tentando m√©todo alternativo...');
          
          // M√©todo 2: Usando export com GIDs
          // IMPORTANTE: Voc√™ precisa descobrir os GIDs corretos das suas abas
          // Abra cada aba e olhe na URL: ...#gid=NUMERO
          [aba1Data, aba2Data, aba3Data] = await Promise.all([
            fetchSheetData(buildSheetURL(0), 'Respostas ao formul√°rio 1'),
            fetchSheetData(buildSheetURL(1234567890), 'Pontua√ß√£o'),
            fetchSheetData(buildSheetURL(9876543210), 'Classifica√ß√£o')
          ]);
        }
        
        console.log('Dados carregados:', {
          aba1: aba1Data.length,
          aba2: aba2Data.length,
          aba3: aba3Data.length
        });
        
        return processData(aba1Data, aba2Data, aba3Data);
      } catch (error) {
        console.error('Erro ao carregar dados:', error);
        showToast('Erro ao carregar dados. Verifique o console e a configura√ß√£o da planilha.', 'error');
        
        // Retornar dados de exemplo para demonstra√ß√£o
        return createSampleData();
      } finally {
        hideLoadingSpinner();
      }
    }
    
    // Fun√ß√£o para criar dados de exemplo (√∫til para demonstra√ß√£o)
    function createSampleData() {
      console.warn('‚ö†Ô∏è Usando dados de exemplo. Configure a planilha corretamente.');
      
      const sampleRespondents = [];
      const areas = ['TI', 'Pedag√≥gico', 'Administrativo', 'Gest√£o', 'RH'];
      const vinculos = ['Docente', 'TAE', 'Gest√£o', 'Terceirizado'];
      const maturidades = ['Iniciante', 'Intermedi√°rio', 'Avan√ßado'];
      
      for (let i = 0; i < 50; i++) {
        sampleRespondents.push({
          email: `usuario${i}@example.com`,
          vinculo: vinculos[Math.floor(Math.random() * vinculos.length)],
          area: areas[Math.floor(Math.random() * areas.length)],
          faixaEtaria: ['18-25', '26-35', '36-45', '46-55', '56+'][Math.floor(Math.random() * 5)],
          vinculacao: ['Efetivo', 'Contrato', 'Tempor√°rio'][Math.floor(Math.random() * 3)],
          contatoIA: Math.random() > 0.3 ? 'Sim' : 'N√£o',
          conhecimentoIA: ['B√°sico'],
          ferramentas: ['ChatGPT', 'Gemini', 'Claude'].slice(0, Math.floor(Math.random() * 3) + 1),
          frequencia: ['Diariamente', 'Semanalmente', 'Mensalmente', 'Raramente'][Math.floor(Math.random() * 4)],
          cuidadosDados: Math.random() > 0.4 ? 'Sim' : 'N√£o',
          pontuacoes: {
            P1: Math.floor(Math.random() * 10),
            P2: Math.floor(Math.random() * 10),
            P3: Math.floor(Math.random() * 10),
            P4: Math.floor(Math.random() * 10),
            P5: Math.floor(Math.random() * 10),
            P6: Math.floor(Math.random() * 10),
            P7: Math.floor(Math.random() * 10),
            P8: Math.floor(Math.random() * 10),
            P9: Math.floor(Math.random() * 10),
            P10: Math.floor(Math.random() * 10),
            P11: Math.floor(Math.random() * 10),
            P12: Math.floor(Math.random() * 10),
            total: 0
          },
          maturidade: maturidades[Math.floor(Math.random() * maturidades.length)],
          trilha: ['Trilha B√°sica', 'Trilha Intermedi√°ria', 'Trilha Avan√ßada'][Math.floor(Math.random() * 3)],
          conhecimentoNivel: Math.floor(Math.random() * 5) + 1
        });
        
        // Calcular total
        sampleRespondents[i].pontuacoes.total = Object.keys(sampleRespondents[i].pontuacoes)
          .filter(k => k.startsWith('P'))
          .reduce((sum, k) => sum + sampleRespondents[i].pontuacoes[k], 0);
      }
      
      return {
        respondents: sampleRespondents,
        metadata: {
          lastUpdate: new Date().toLocaleString('pt-BR'),
          totalRespondents: sampleRespondents.length
        }
      };
    }
    
    function processData(aba1, aba2, aba3) {
      const respondents = [];
      
      const minLength = Math.min(aba1.length, aba2.length, aba3.length);
      
      if (aba1.length !== aba2.length || aba1.length !== aba3.length) {
        console.warn('‚ö†Ô∏è N√∫mero de linhas inconsistente entre abas. Usando menor comprimento.');
      }
      
      const cols1 = Object.keys(aba1[0] || {});
      const cols2 = Object.keys(aba2[0] || {});
      const cols3 = Object.keys(aba3[0] || {});
      
      for (let i = 0; i < minLength; i++) {
        const row1 = aba1[i];
        const row2 = aba2[i];
        const row3 = aba3[i];
        
        const email = row1[cols1[1]] || '';
        const vinculo = row1[cols1[3]] || 'N√£o informado';
        const area = row1[cols1[4]] || 'N√£o informado';
        const faixaEtaria = row1[cols1[6]] || 'N√£o informado';
        const vinculacao = row1[cols1[7]] || 'N√£o informado';
        const contatoIA = mapContatoIA(row1[cols1[9]]);
        const conhecimentoIA = splitMultipleChoice(row1[cols1[11]]);
        const ferramentas = splitMultipleChoice(row1[cols1[12]]);
        const frequencia = row1[cols1[13]] || 'N√£o informado';
        const cuidadosDados = mapCuidadosDados(row1[cols1[23]]);
        
        const pontuacoes = {
          P1: parseFloat(row2[cols2[0]]) || 0,
          P2: parseFloat(row2[cols2[1]]) || 0,
          P3: parseFloat(row2[cols2[2]]) || 0,
          P4: parseFloat(row2[cols2[3]]) || 0,
          P5: parseFloat(row2[cols2[4]]) || 0,
          P6: parseFloat(row2[cols2[5]]) || 0,
          P7: parseFloat(row2[cols2[6]]) || 0,
          P8: parseFloat(row2[cols2[7]]) || 0,
          P9: parseFloat(row2[cols2[8]]) || 0,
          P10: parseFloat(row2[cols2[9]]) || 0,
          P11: parseFloat(row2[cols2[10]]) || 0,
          P12: parseFloat(row2[cols2[11]]) || 0,
          total: parseFloat(row2[cols2[12]]) || 0
        };
        
        const maturidade = row3[cols3[0]] || classifyMaturity(pontuacoes.total);
        const trilha = row3[cols3[1]] || 'N√£o definida';
        
        const conhecimentoNivel = conhecimentoIA.length > 0 
          ? convertKnowledgeLevel(conhecimentoIA[0]) 
          : 1;
        
        respondents.push({
          email,
          vinculo,
          area,
          faixaEtaria,
          vinculacao,
          contatoIA,
          conhecimentoIA,
          ferramentas,
          frequencia,
          cuidadosDados,
          pontuacoes,
          maturidade,
          trilha,
          conhecimentoNivel
        });
      }
      
      return {
        respondents,
        metadata: {
          lastUpdate: new Date().toLocaleString('pt-BR'),
          totalRespondents: respondents.length
        }
      };
    }
    
    function validateData(data) {
      const issues = [];
      
      if (!data.respondents || data.respondents.length === 0) {
        issues.push({
          severity: 'critical',
          message: 'Nenhum dado foi carregado da planilha. Verifique a configura√ß√£o.'
        });
      }
      
      const emails = data.respondents.map(r => r.email);
      const uniqueEmails = new Set(emails);
      
      if (emails.length !== uniqueEmails.size) {
        issues.push({
          severity: 'warning',
          message: 'Existem e-mails duplicados na planilha.'
        });
      }
      
      return issues;
    }
    
    // ============================================================
    // FILTER FUNCTIONS
    // ============================================================
    
    function applyFilters() {
      const emailFilter = document.getElementById('filterEmail').value.toLowerCase();
      const vinculoFilter = document.getElementById('filterVinculo').value;
      const areaFilter = document.getElementById('filterArea').value;
      const faixaFilter = document.getElementById('filterFaixaEtaria').value;
      const vinculacaoFilter = document.getElementById('filterVinculacao').value;
      
      filteredData = dashboardData.respondents.filter(r => {
        const emailMatch = !emailFilter || r.email.toLowerCase().includes(emailFilter);
        const vinculoMatch = !vinculoFilter || r.vinculo === vinculoFilter;
        const areaMatch = !areaFilter || r.area === areaFilter;
        const faixaMatch = !faixaFilter || r.faixaEtaria === faixaFilter;
        const vinculacaoMatch = !vinculacaoFilter || r.vinculacao === vinculacaoFilter;
        
        return emailMatch && vinculoMatch && areaMatch && faixaMatch && vinculacaoMatch;
      });
      
      updateFilterCount();
      renderAllCharts(filteredData);
    }
    
    function updateFilterCount() {
      const count = document.getElementById('filterCount');
      count.textContent = `Exibindo ${filteredData.length} de ${dashboardData.metadata.totalRespondents} respondentes`;
    }
    
    function populateFilters(data) {
      const vinculos = [...new Set(data.map(r => r.vinculo))].sort();
      const areas = [...new Set(data.map(r => r.area))].sort();
      const faixas = [...new Set(data.map(r => r.faixaEtaria))].sort();
      const vinculacoes = [...new Set(data.map(r => r.vinculacao))].sort();
      
      const vinculoSelect = document.getElementById('filterVinculo');
      const areaSelect = document.getElementById('filterArea');
      const faixaSelect = document.getElementById('filterFaixaEtaria');
      const vinculacaoSelect = document.getElementById('filterVinculacao');
      
      vinculos.forEach(v => {
        const option = document.createElement('option');
        option.value = v;
        option.textContent = v;
        vinculoSelect.appendChild(option);
      });
      
      areas.forEach(a => {
        const option = document.createElement('option');
        option.value = a;
        option.textContent = a;
        areaSelect.appendChild(option);
      });
      
      faixas.forEach(f => {
        const option = document.createElement('option');
        option.value = f;
        option.textContent = f;
        faixaSelect.appendChild(option);
      });
      
      vinculacoes.forEach(v => {
        const option = document.createElement('option');
        option.value = v;
        option.textContent = v;
        vinculacaoSelect.appendChild(option);
      });
    }
    
    function clearFilters() {
      document.getElementById('filterEmail').value = '';
      document.getElementById('filterVinculo').value = '';
      document.getElementById('filterArea').value = '';
      document.getElementById('filterFaixaEtaria').value = '';
      document.getElementById('filterVinculacao').value = '';
      
      applyFilters();
    }
    
    // ============================================================
    // KPI RENDERING
    // ============================================================
    
    function renderKPIs(data) {
      const total = data.length;
      
      if (total === 0) {
        document.getElementById('kpiTotal').textContent = '0';
        document.getElementById('kpiMaturidade').textContent = '0.0';
        document.getElementById('kpiAdocao').textContent = '0%';
        document.getElementById('kpiConformidade').textContent = '0%';
        document.getElementById('kpiIPO').textContent = '0.0';
        document.getElementById('kpiRisco').textContent = '0%';
        return;
      }
      
      document.getElementById('kpiTotal').textContent = total;
      
      const avgMaturity = data.reduce((sum, r) => sum + r.pontuacoes.total, 0) / total;
      document.getElementById('kpiMaturidade').textContent = avgMaturity.toFixed(1);
      document.getElementById('progressMaturidade').style.width = `${avgMaturity}%`;
      
      if (avgMaturity > 70) {
        document.getElementById('progressMaturidade').style.background = '#4CAF50';
      } else if (avgMaturity > 40) {
        document.getElementById('progressMaturidade').style.background = '#FF9800';
      } else {
        document.getElementById('progressMaturidade').style.background = '#F44336';
      }
      
      const adocao = (data.filter(r => r.contatoIA === 'Sim').length / total * 100).toFixed(0);
      document.getElementById('kpiAdocao').textContent = `${adocao}%`;
      
      const conformidade = (data.filter(r => r.cuidadosDados === 'Sim').length / total * 100).toFixed(0);
      document.getElementById('kpiConformidade').textContent = `${conformidade}%`;
      
      const ipo = (avgMaturity * parseFloat(adocao) * parseFloat(conformidade) / 10000).toFixed(1);
      document.getElementById('kpiIPO').textContent = ipo;
      
      let ipoStatus = 'CR√çTICO';
      let ipoColor = '#F44336';
      if (ipo > 60) {
        ipoStatus = 'SAUD√ÅVEL';
        ipoColor = '#4CAF50';
      } else if (ipo > 30) {
        ipoStatus = 'ATEN√á√ÉO';
        ipoColor = '#FF9800';
      }
      document.getElementById('kpiIPOStatus').textContent = `/100 - Status: ${ipoStatus}`;
      document.getElementById('kpiIPOStatus').style.color = ipoColor;
      
      const risco = data.filter(r => r.contatoIA === 'Sim' && r.cuidadosDados === 'N√£o').length;
      const riscoPercent = (risco / total * 100).toFixed(0);
      document.getElementById('kpiRisco').textContent = `${riscoPercent}%`;
      document.getElementById('kpiRiscoCount').textContent = `${risco} colaboradores`;
    }
    
    // ============================================================
    // CHART RENDERING
    // ============================================================
    
    function renderAllCharts(data) {
      if (!data || data.length === 0) {
        console.warn('Nenhum dado dispon√≠vel para renderizar gr√°ficos');
        return;
      }
      
      renderKPIs(data);
      renderChart1_Maturity(data);
      renderChart2_Tools(data);
      renderChart3_Frequency(data);
      renderChart4_AreasKnowledge(data);
      renderChart5_Radar(data);
      renderChart6_Histogram(data);
      renderChart7_MaturityByVinculo(data);
      renderChart8_Trilhas(data);
      renderChart9_Scatter(data);
      renderChart10_Heatmap(data);
      renderPriorityTable(data);
      renderRecommendations(data);
    }
    
    function renderChart1_Maturity(data) {
      const counts = {
        'Iniciante': 0,
        'Intermedi√°rio': 0,
        'Avan√ßado': 0
      };
      
      data.forEach(r => {
        counts[r.maturidade]++;
      });
      
      const ctx = document.getElementById('chartMaturity');
      
      if (charts.maturity) {
        charts.maturity.destroy();
      }
      
      charts.maturity = new Chart(ctx, {
        type: 'doughnut',
        data: {
          labels: Object.keys(counts),
          datasets: [{
            data: Object.values(counts),
            backgroundColor: ['#F44336', '#FF9800', '#4CAF50'],
            borderWidth: 2,
            borderColor: '#fff'
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          plugins: {
            legend: {
              position: 'bottom'
            },
            tooltip: {
              callbacks: {
                label: function(context) {
                  const label = context.label || '';
                  const value = context.parsed || 0;
                  const total = data.length;
                  const percent = ((value / total) * 100).toFixed(1);
                  return `${label}: ${value} (${percent}%)`;
                }
              }
            }
          }
        }
      });
    }
    
    function renderChart2_Tools(data) {
      const toolCounts = {};
      
      data.forEach(r => {
        r.ferramentas.forEach(tool => {
          toolCounts[tool] = (toolCounts[tool] || 0) + 1;
        });
      });
      
      const sortedTools = Object.entries(toolCounts)
        .sort((a, b) => b[1] - a[1])
        .slice(0, 5);
      
      const ctx = document.getElementById('chartTools');
      
      if (charts.tools) {
        charts.tools.destroy();
      }
      
      charts.tools = new Chart(ctx, {
        type: 'bar',
        data: {
          labels: sortedTools.map(t => t[0]),
          datasets: [{
            label: 'N√∫mero de usu√°rios',
            data: sortedTools.map(t => t[1]),
            backgroundColor: '#2196F3',
            borderRadius: 5
          }]
        },
        options: {
          indexAxis: 'y',
          responsive: true,
          maintainAspectRatio: false,
          plugins: {
            legend: {
              display: false
            },
            tooltip: {
              callbacks: {
                label: function(context) {
                  const value = context.parsed.x;
                  const total = data.length;
                  const percent = ((value / total) * 100).toFixed(1);
                  return `${value} usu√°rios (${percent}%)`;
                }
              }
            }
          },
          scales: {
            x: {
              beginAtZero: true
            }
          }
        }
      });
    }
    
    function renderChart3_Frequency(data) {
      const freqCounts = {};
      
      data.forEach(r => {
        const freq = r.frequencia || 'N√£o informado';
        freqCounts[freq] = (freqCounts[freq] || 0) + 1;
      });
      
      const ctx = document.getElementById('chartFrequency');
      
      if (charts.frequency) {
        charts.frequency.destroy();
      }
      
      charts.frequency = new Chart(ctx, {
        type: 'pie',
        data: {
          labels: Object.keys(freqCounts),
          datasets: [{
            data: Object.values(freqCounts),
            backgroundColor: ['#2196F3', '#4CAF50', '#FF9800', '#F44336', '#9C27B0'],
            borderWidth: 2,
            borderColor: '#fff'
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          plugins: {
            legend: {
              position: 'bottom'
            }
          }
        }
      });
    }
    
    function renderChart4_AreasKnowledge(data) {
      const areaKnowledge = {};
      
      data.forEach(r => {
        const key = `${r.area}`;
        if (!areaKnowledge[key]) {
          areaKnowledge[key] = {
            count: 0,
            totalKnowledge: 0,
            maturity: r.maturidade
          };
        }
        areaKnowledge[key].count++;
        areaKnowledge[key].totalKnowledge += r.conhecimentoNivel;
      });
      
      const sortedAreas = Object.entries(areaKnowledge)
        .sort((a, b) => b[1].count - a[1].count)
        .slice(0, 8);
      
      const ctx = document.getElementById('chartAreasKnowledge');
      
      if (charts.areasKnowledge) {
        charts.areasKnowledge.destroy();
      }
      
      charts.areasKnowledge = new Chart(ctx, {
        type: 'bar',
        data: {
          labels: sortedAreas.map(a => a[0]),
          datasets: [{
            label: 'N√∫mero de respondentes',
            data: sortedAreas.map(a => a[1].count),
            backgroundColor: sortedAreas.map(a => {
              const avgKnowledge = a[1].totalKnowledge / a[1].count;
              if (avgKnowledge >= 4) return '#4CAF50';
              if (avgKnowledge >= 3) return '#FF9800';
              return '#F44336';
            }),
            borderRadius: 5
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          plugins: {
            legend: {
              display: false
            }
          },
          scales: {
            y: {
              beginAtZero: true
            }
          }
        }
      });
    }
    
    function renderChart5_Radar(data) {
      const avgScores = {
        P1: 0, P2: 0, P3: 0, P4: 0, P5: 0, P6: 0,
        P7: 0, P8: 0, P9: 0, P10: 0, P11: 0, P12: 0
      };
      
      data.forEach(r => {
        for (let i = 1; i <= 12; i++) {
          avgScores[`P${i}`] += r.pontuacoes[`P${i}`];
        }
      });
      
      Object.keys(avgScores).forEach(key => {
        avgScores[key] = (avgScores[key] / data.length).toFixed(2);
      });
      
      const ctx = document.getElementById('chartRadar');
      
      if (charts.radar) {
        charts.radar.destroy();
      }
      
      charts.radar = new Chart(ctx, {
        type: 'radar',
        data: {
          labels: ['P1', 'P2', 'P3', 'P4', 'P5', 'P6', 'P7', 'P8', 'P9', 'P10', 'P11', 'P12'],
          datasets: [{
            label: 'M√©dia Global',
            data: Object.values(avgScores),
            borderColor: '#2196F3',
            backgroundColor: 'rgba(33, 150, 243, 0.2)',
            pointBackgroundColor: '#2196F3',
            pointBorderColor: '#fff',
            pointRadius: 4
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          scales: {
            r: {
              beginAtZero: true,
              max: 10,
              ticks: {
                stepSize: 2
              }
            }
          },
          plugins: {
            legend: {
              position: 'top'
            }
          }
        }
      });
    }
    
    function renderChart6_Histogram(data) {
      const bins = {
        '0-20': 0,
        '21-40': 0,
        '41-60': 0,
        '61-80': 0,
        '81-100': 0
      };
      
      data.forEach(r => {
        const score = r.pontuacoes.total;
        if (score <= 20) bins['0-20']++;
        else if (score <= 40) bins['21-40']++;
        else if (score <= 60) bins['41-60']++;
        else if (score <= 80) bins['61-80']++;
        else bins['81-100']++;
      });
      
      const ctx = document.getElementById('chartHistogram');
      
      if (charts.histogram) {
        charts.histogram.destroy();
      }
      
      charts.histogram = new Chart(ctx, {
        type: 'bar',
        data: {
          labels: Object.keys(bins),
          datasets: [{
            label: 'N√∫mero de respondentes',
            data: Object.values(bins),
            backgroundColor: ['#F44336', '#FF9800', '#FFC107', '#8BC34A', '#4CAF50'],
            borderRadius: 5
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          plugins: {
            legend: {
              display: false
            }
          },
          scales: {
            y: {
              beginAtZero: true
            }
          }
        }
      });
    }
    
    function renderChart7_MaturityByVinculo(data) {
      const vinculoData = {};
      
      data.forEach(r => {
        if (!vinculoData[r.vinculo]) {
          vinculoData[r.vinculo] = {
            Iniciante: 0,
            Intermedi√°rio: 0,
            Avan√ßado: 0,
            total: 0
          };
        }
        vinculoData[r.vinculo][r.maturidade]++;
        vinculoData[r.vinculo].total++;
      });
      
      const vinculos = Object.keys(vinculoData);
      const iniciante = vinculos.map(v => (vinculoData[v].Iniciante / vinculoData[v].total * 100).toFixed(1));
      const intermediario = vinculos.map(v => (vinculoData[v].Intermedi√°rio / vinculoData[v].total * 100).toFixed(1));
      const avancado = vinculos.map(v => (vinculoData[v].Avan√ßado / vinculoData[v].total * 100).toFixed(1));
      
      const ctx = document.getElementById('chartMaturityByVinculo');
      
      if (charts.maturityByVinculo) {
        charts.maturityByVinculo.destroy();
      }
      
      charts.maturityByVinculo = new Chart(ctx, {
        type: 'bar',
        data: {
          labels: vinculos,
          datasets: [
            {
              label: 'Iniciante',
              data: iniciante,
              backgroundColor: '#F44336'
            },
            {
              label: 'Intermedi√°rio',
              data: intermediario,
              backgroundColor: '#FF9800'
            },
            {
              label: 'Avan√ßado',
              data: avancado,
              backgroundColor: '#4CAF50'
            }
          ]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          scales: {
            x: {
              stacked: true
            },
            y: {
              stacked: true,
              max: 100
            }
          },
          plugins: {
            legend: {
              position: 'bottom'
            }
          }
        }
      });
    }
    
    function renderChart8_Trilhas(data) {
      const trilhaCounts = {};
      
      data.forEach(r => {
        const trilha = r.trilha || 'N√£o definida';
        trilhaCounts[trilha] = (trilhaCounts[trilha] || 0) + 1;
      });
      
      const sortedTrilhas = Object.entries(trilhaCounts)
        .sort((a, b) => b[1] - a[1]);
      
      const ctx = document.getElementById('chartTrilhas');
      
      if (charts.trilhas) {
        charts.trilhas.destroy();
      }
      
      charts.trilhas = new Chart(ctx, {
        type: 'bar',
        data: {
          labels: sortedTrilhas.map(t => t[0]),
          datasets: [{
            label: 'N√∫mero de respondentes',
            data: sortedTrilhas.map(t => t[1]),
            backgroundColor: '#2196F3',
            borderRadius: 5
          }]
        },
        options: {
          indexAxis: 'y',
          responsive: true,
          maintainAspectRatio: false,
          plugins: {
            legend: {
              display: false
            }
          },
          scales: {
            x: {
              beginAtZero: true
            }
          }
        }
      });
    }
    
    function renderChart9_Scatter(data) {
      const scatterData = data.map(r => ({
        x: r.pontuacoes.total,
        y: r.conhecimentoNivel,
        label: r.email
      }));
      
      const talents = scatterData.filter(d => d.x > 60 && d.y < 4);
      const risks = scatterData.filter(d => d.x <= 60 && d.y >= 4);
      const beginners = scatterData.filter(d => d.x <= 60 && d.y < 4);
      const ambassadors = scatterData.filter(d => d.x > 60 && d.y >= 4);
      
      const ctx = document.getElementById('chartScatter');
      
      if (charts.scatter) {
        charts.scatter.destroy();
      }
      
      charts.scatter = new Chart(ctx, {
        type: 'scatter',
        data: {
          datasets: [
            {
              label: 'Embaixadores',
              data: ambassadors,
              backgroundColor: '#4CAF50',
              pointRadius: 6
            },
            {
              label: 'Talentos Ocultos',
              data: talents,
              backgroundColor: '#2196F3',
              pointRadius: 6
            },
            {
              label: 'Zona de Risco',
              data: risks,
              backgroundColor: '#F44336',
              pointRadius: 6
            },
            {
              label: 'Iniciantes Conscientes',
              data: beginners,
              backgroundColor: '#FF9800',
              pointRadius: 6
            }
          ]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          scales: {
            x: {
              title: {
                display: true,
                text: 'Pontua√ß√£o Real (0-100)'
              },
              min: 0,
              max: 100
            },
            y: {
              title: {
                display: true,
                text: 'Conhecimento Autodeclarado (1-5)'
              },
              min: 0,
              max: 6
            }
          },
          plugins: {
            legend: {
              position: 'bottom'
            }
          }
        }
      });
    }
    
    function renderChart10_Heatmap(data) {
      const avgScores = [];
      
      for (let i = 1; i <= 12; i++) {
        const avg = data.reduce((sum, r) => sum + r.pontuacoes[`P${i}`], 0) / data.length;
        avgScores.push(avg.toFixed(2));
      }
      
      const ctx = document.getElementById('chartHeatmap');
      
      if (charts.heatmap) {
        charts.heatmap.destroy();
      }
      
      charts.heatmap = new Chart(ctx, {
        type: 'bar',
        data: {
          labels: ['P1', 'P2', 'P3', 'P4', 'P5', 'P6', 'P7', 'P8', 'P9', 'P10', 'P11', 'P12'],
          datasets: [{
            label: 'Pontua√ß√£o M√©dia',
            data: avgScores,
            backgroundColor: avgScores.map(score => {
              const normalized = parseFloat(score) / 10;
              const r = Math.floor(255 * (1 - normalized));
              const b = Math.floor(255 * normalized);
              return `rgba(${r}, 100, ${b}, 0.7)`;
            }),
            borderRadius: 5
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          plugins: {
            legend: {
              display: false
            }
          },
          scales: {
            y: {
              beginAtZero: true,
              max: 10
            }
          }
        }
      });
    }
    
    function renderPriorityTable(data) {
      const vinculoData = {};
      
      data.forEach(r => {
        if (!vinculoData[r.vinculo]) {
          vinculoData[r.vinculo] = {
            total: 0,
            iniciante: 0
          };
        }
        vinculoData[r.vinculo].total++;
        if (r.maturidade === 'Iniciante') {
          vinculoData[r.vinculo].iniciante++;
        }
      });
      
      const rows = Object.entries(vinculoData)
        .map(([vinculo, stats]) => ({
          vinculo,
          total: stats.total,
          iniciantePercent: (stats.iniciante / stats.total * 100).toFixed(1)
        }))
        .sort((a, b) => b.iniciantePercent - a.iniciantePercent);
      
      const tbody = document.getElementById('priorityTableBody');
      tbody.innerHTML = '';
      
      rows.forEach(row => {
        const tr = document.createElement('tr');
        
        let actionClass = 'action-success';
        let actionText = 'üü¢ Mentoria avan√ßada';
        
        if (row.iniciantePercent > 60) {
          actionClass = 'action-critical';
          actionText = 'üî¥ Workshop urgente';
        } else if (row.iniciantePercent > 40) {
          actionClass = 'action-warning';
          actionText = 'üü° Capacita√ß√£o trimestral';
        }
        
        tr.innerHTML = `
          <td><strong>${row.vinculo}</strong></td>
          <td>${row.total}</td>
          <td>${row.iniciantePercent}%</td>
          <td><span class="action-badge ${actionClass}">${actionText}</span></td>
        `;
        
        tbody.appendChild(tr);
      });
    }
    
    function renderRecommendations(data) {
      const recommendations = [];
      
      const riskUsers = data.filter(r => r.contatoIA === 'Sim' && r.cuidadosDados === 'N√£o');
      if (riskUsers.length > 0) {
        recommendations.push({
          type: 'critical',
          icon: '‚ö†Ô∏è',
          title: `ALERTA CR√çTICO: ${riskUsers.length} colaboradores em zona de risco`,
          action: '‚Üí A√ß√£o: Workshop LGPD + IA - Pr√≥xima segunda-feira'
        });
      }
      
      const hiddenTalents = data.filter(r => r.pontuacoes.total > 60 && r.conhecimentoNivel < 4);
      if (hiddenTalents.length > 0) {
        recommendations.push({
          type: 'opportunity',
          icon: 'üìä',
          title: `OPORTUNIDADE: ${hiddenTalents.length} "Talentos Ocultos" identificados`,
          action: '‚Üí A√ß√£o: Convidar para programa de mentoria reversa'
        });
      }
      
      const areaStats = {};
      data.forEach(r => {
        if (!areaStats[r.area]) {
          areaStats[r.area] = { total: 0, iniciante: 0 };
        }
        areaStats[r.area].total++;
        if (r.maturidade === 'Iniciante') {
          areaStats[r.area].iniciante++;
        }
      });
      
      Object.entries(areaStats).forEach(([area, stats]) => {
        const iniciantePercent = (stats.iniciante / stats.total);
        if (iniciantePercent > 0.6) {
          recommendations.push({
            type: 'priority',
            icon: 'üéØ',
            title: `PRIORIDADE: √Årea "${area}" - ${Math.round(iniciantePercent * 100)}% Iniciantes`,
            action: '‚Üí A√ß√£o: Trilha b√°sica obrigat√≥ria - Prazo: 30 dias'
          });
        }
      });
      
      const container = document.getElementById('recommendationsContainer');
      container.innerHTML = '';
      
      if (recommendations.length === 0) {
        container.innerHTML = '<p style="text-align: center; color: var(--color-text-secondary);">‚úÖ Nenhuma recomenda√ß√£o cr√≠tica no momento. Continue monitorando!</p>';
        return;
      }
      
      recommendations.forEach(rec => {
        const card = document.createElement('div');
        card.className = `recommendation-card ${rec.type}`;
        card.innerHTML = `
          <div class="recommendation-header">
            <div class="recommendation-icon">${rec.icon}</div>
            <div class="recommendation-title">${rec.title}</div>
          </div>
          <div class="recommendation-action">${rec.action}</div>
        `;
        container.appendChild(card);
      });
    }
    
    // ============================================================
    // EXPORT FUNCTIONS
    // ============================================================
    
    function exportCSV() {
      if (!filteredData || filteredData.length === 0) {
        showToast('Nenhum dado para exportar', 'error');
        return;
      }
      
      const headers = ['Email', 'V√≠nculo', '√Årea', 'Maturidade', 'Pontua√ß√£o', 'Contato IA', 'Cuidados Dados'];
      const rows = filteredData.map(r => [
        r.email,
        r.vinculo,
        r.area,
        r.maturidade,
        r.pontuacoes.total,
        r.contatoIA,
        r.cuidadosDados
      ]);
      
      let csv = headers.join(',') + '\n';
      rows.forEach(row => {
        csv += row.map(cell => `"${cell}"`).join(',') + '\n';
      });
      
      const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
      const link = document.createElement('a');
      const url = URL.createObjectURL(blob);
      
      link.setAttribute('href', url);
      link.setAttribute('download', `dashboard_maturidade_ia_${new Date().toISOString().split('T')[0]}.csv`);
      link.style.visibility = 'hidden';
      
      document.body.appendChild(link);
      link.click();
      document.body.removeChild(link);
      
      showToast('Dados exportados com sucesso!');
    }
    
    // ============================================================
    // EVENT LISTENERS
    // ============================================================
    
    function setupEventListeners() {
      document.getElementById('btnRefresh').addEventListener('click', async () => {
        const btn = document.getElementById('btnRefresh');
        btn.classList.add('loading');
        btn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Atualizando...';
        
        try {
          await initDashboard();
          showToast('Dados atualizados com sucesso!');
        } catch (error) {
          showToast('Erro ao atualizar dados', 'error');
        } finally {
          btn.classList.remove('loading');
          btn.innerHTML = '<i class="fas fa-sync-alt"></i> Atualizar Dados';
        }
      });
      
      document.getElementById('btnClearFilters').addEventListener('click', clearFilters);
      
      document.getElementById('filterEmail').addEventListener('input', applyFilters);
      document.getElementById('filterVinculo').addEventListener('change', applyFilters);
      document.getElementById('filterArea').addEventListener('change', applyFilters);
      document.getElementById('filterFaixaEtaria').addEventListener('change', applyFilters);
      document.getElementById('filterVinculacao').addEventListener('change', applyFilters);
    }
    
    // ============================================================
    // INITIALIZATION
    // ============================================================
    
    async function initDashboard() {
      dashboardData = await loadAllData();
      
      const issues = validateData(dashboardData);
      
      if (issues.length > 0) {
        const banner = document.getElementById('validationBanner');
        const details = document.getElementById('validationDetails');
        banner.classList.add('active');
        details.innerHTML = issues.map(i => `<p>‚Ä¢ ${i.message}</p>`).join('');
      }
      
      filteredData = dashboardData.respondents;
      
      populateFilters(dashboardData.respondents);
      renderAllCharts(filteredData);
      
      document.getElementById('lastUpdate').textContent = `√öltima atualiza√ß√£o: ${dashboardData.metadata.lastUpdate}`;
      updateFilterCount();
    }
    
    document.addEventListener('DOMContentLoaded', async () => {
      console.log('üöÄ Iniciando Dashboard de Maturidade em IA...');
      setupEventListeners();
      await initDashboard();
      console.log('‚úì Dashboard carregado com sucesso!');
    });
  </script>
</body>
</html>